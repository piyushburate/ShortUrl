<div class="links_container">
    <div class="title">Links</div>
    <div class="link_list">
        <div class="title">Overview</div>
        <!-- Sample Link -->
        <!-- <div class="link">
            <span class="link_active"></span>
            <span class="date_created">JUN 8, 2023</span>
            <span class="long_url">https://ubuntu.com/tutorials/command-line-for-beginners#1-overview</span>
            <span class="short_url">short.url/lectlinux21</span>
            <div class="clicks">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                </svg>
                <span>2698</span>
            </div>
        </div> -->
    </div>
    <div class="link_overview">
        <div class="link_header">
            <span class="title">Link Overview</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </div>
        <div class="link_details">
            <div class="title">
                <span>Study Drive Folder</span>
                <button class="edit">Edit</button>
            </div>
            <div class="datetime_created">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                </svg>
                <span>August 23, 2022 7:33 PM GMT+5:30</span>
            </div>
            <div class="clicks">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                </svg>
                <span> Engagements</span>
            </div>
        </div>
        <div class="link_data">
            <div class="short_url">
                <span>short.url/</span>
                <button class="copy">Copy</button>
            </div>
            <div class="clicks">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59" />
                </svg>
                <span> clicks</span>
            </div>
            <div class="long_url">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244" />
                </svg>
                <a href="#" target="_blank">link</a>
            </div>
            <div class="qr_section">
                <div class="title">QR Code</div>
                <div class="qr_code">
                    <img src="/static/img/qr_code.jpg" alt="QR Code">
                </div>
                <div class="qr_actions">
                    <button class="share">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M7.217 10.907a2.25 2.25 0 100 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186l9.566-5.314m-9.566 7.5l9.566 5.314m0 0a2.25 2.25 0 103.935 2.186 2.25 2.25 0 00-3.935-2.186zm0-12.814a2.25 2.25 0 103.933-2.185 2.25 2.25 0 00-3.933 2.185z" />
                        </svg>
                        <span>Share</span>
                    </button>
                    <button class="download">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                        <span>Download</span>
                    </button>
                    <button class="activation">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M5.636 5.636a9 9 0 1012.728 0M12 3v9" />
                        </svg>
                        <span>Deactivate</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Create New Dialog -->
    <form action="/create_short_link" method="post">
        <div class="dialog">
            <div class="dialog_box">
                <div class="dialog_header">
                    <div class="title">Create new</div>
                    <div class="close_btn">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </div>
                </div>
                <div class="dialog_body">
                    <div class="input longurl">
                        <label for="form_longurl">Long URL</label>
                        <input type="text" id="form_longurl" required>
                    </div>
                    <div class="input title">
                        <label for="form_title">Title (optional)</label>
                        <input type="text" id="form_title" required>
                    </div>
                    <div class="input shorturl">
                        <label for="form_shorturl">Short URL code</label>
                        <span class="input_prefix">short.url</span>
                        <span class="divider">/</span>
                        <input type="text" id="form_shorturl" size="1" required>
                    </div>
                </div>
                <div class="dialog_footer">
                    <input type="submit" value="Create">
                </div>
            </div>
        </div>
    </form>
</div>

<script>

    var linkClick = async (link, id) => {
        $(".link").each((i, l) => {
            $(l).removeClass("active")
        })
        $(link).addClass("active")
        $(".link_overview").addClass("active")
        $(".link_overview .link_header svg").on("click", () => {
            $(link).removeClass("active")
            $(".link_overview").removeClass("active")
            $(".link_overview .link_header svg").on("click", null)
        })

        var data = await makeRequest("/api/db/links/" + id)
        if (!data.status) {
            if (data.statusCode == 10) {
                window.location.reload()
            } else {
                console.log("Error: " + data.result);
            }
        } else {
            data = data.result
            $(".link_details .title span").html(data[0].title)
            $(".link_details .datetime_created span").html(data[0].datetime)
            $(".link_overview .link_details .clicks span").html(data[0].clicks + " Engagements")
            $(".link_overview .link_data .clicks span").html(data[0].clicks + " clicks")
            $(".link_overview .short_url span").html("short.url/" + data[0].code)
            $(".link_overview .long_url a").html(data[0].link)
            $(".link_overview .long_url a").attr("href", data[0].link)
            $(".link_overview .short_url .copy").on("click", () => {
                var copy = $('<input>').val(window.location.host + "/" + data[0].code)
                $("body").append(copy)
                copy.select()
                document.execCommand("copy")
                document.activeElement.blur()
                copy.remove()
                $(".link_overview .short_url .copy").text("Copied!")
                setTimeout(() => {
                    $(".link_overview .short_url .copy").text("Copy")
                }, 3000);
            })
        }
    }


    var loadLinks = async () => {
        let data = await makeRequest("/api/db/links")
        if (!data.status) {
            if (data.statusCode == 10) {
                window.location.reload()
            } else {
                console.log("Error: " + data.result);
            }
        } else {
            data = data.result
            for (let i = 0; i < data.length; i++) {
                var link =
                    `<div class="link">
                    <span class="link_active ${data[i].link_active == 1}"></span>
                    <span class="date_created">${data[i].datetime}</span>
                    <span class="long_url">${data[i].link}</span>
                    <span class="short_url">short.url/${data[i].code}</span>
                    <div class="clicks">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M12.75 19.5v-.75a7.5 7.5 0 00-7.5-7.5H4.5m0-6.75h.75c7.87 0 14.25 6.38 14.25 14.25v.75M6 18.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
                        </svg>
                        <span>${data[i].clicks}</span>
                        </div>
                        </div>`
                var linkElement = $(link)
                linkElement.on("click", () => {
                    linkClick(linkElement, data[i].id)
                })
                $(".link_list").append(linkElement)
            }
        }
    }

    loadLinks()
</script>